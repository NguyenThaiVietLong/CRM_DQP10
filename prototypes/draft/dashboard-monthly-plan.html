<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard K·∫ø ho·∫°ch Th√°ng - D√¢n Qu√¢n T·ª± V·ªá</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              olive: {
                DEFAULT: "#697565",
                50: "#f6f7f6",
                100: "#e3e6e2",
                200: "#c7cdc5",
                300: "#a5ada0",
                400: "#858e7f",
                500: "#697565",
                600: "#535d50",
                700: "#434a42",
                800: "#373c36",
                900: "#2f332e",
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-50" x-data="dashboardMonthlyPlan()">
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <aside
        class="w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col p-4 hidden md:flex h-full"
      >
        <div class="flex gap-3 px-2 py-2 mb-4">
          <div
            class="bg-olive/20 rounded-full size-10 flex items-center justify-center"
          >
            <span class="material-symbols-outlined text-olive">shield</span>
          </div>
          <div class="flex flex-col justify-center">
            <h1 class="text-gray-900 text-base font-bold">D√¢n Qu√¢n T·ª± V·ªá</h1>
            <p class="text-gray-500 text-xs">H·ªá th·ªëng qu·∫£n l√Ω</p>
          </div>
        </div>

        <nav class="flex flex-col gap-2">
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"
            href="index.html"
          >
            <span class="material-symbols-outlined text-gray-600">home</span>
            <p class="text-sm font-medium text-gray-600">Trang ch·ªß</p>
          </a>
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"
            href="dashboard-annual-plan.html"
          >
            <span class="material-symbols-outlined text-gray-600"
              >calendar_today</span
            >
            <p class="text-sm font-medium text-gray-600">Dashboard KH NƒÉm</p>
          </a>
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg bg-olive/10"
            href="#"
          >
            <span
              class="material-symbols-outlined text-olive"
              style="font-variation-settings: 'FILL' 1"
              >calendar_month</span
            >
            <p class="text-sm font-bold text-olive">Dashboard KH Th√°ng</p>
          </a>
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"
            href="settings-annual-plan.html"
          >
            <span class="material-symbols-outlined text-gray-600"
              >settings</span
            >
            <p class="text-sm font-medium text-gray-600">C√†i ƒë·∫∑t KH NƒÉm</p>
          </a>
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"
            href="settings-monthly-plan.html"
          >
            <span class="material-symbols-outlined text-gray-600">tune</span>
            <p class="text-sm font-medium text-gray-600">C√†i ƒë·∫∑t KH Th√°ng</p>
          </a>
        </nav>

        <div class="mt-auto pt-4 border-t border-gray-200">
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-bold bg-olive text-white hover:bg-olive/90 justify-center"
            href="#"
          >
            <span class="material-symbols-outlined text-xl">logout</span>
            <span>ƒêƒÉng xu·∫•t</span>
          </a>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 px-6 py-4">
          <div class="flex items-center justify-between mb-3">
            <div>
              <h1 class="text-2xl font-bold text-gray-900">
                Dashboard K·∫ø ho·∫°ch Th√°ng
              </h1>
              <p class="text-sm text-gray-500 mt-1">
                Theo d√µi ti·∫øn ƒë·ªô KPI theo t·ª´ng th√°ng
              </p>
            </div>
            <select
              x-model="selectedMonth"
              @change="loadMonthData"
              class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive"
            >
              <option value="1">Th√°ng 1/2026</option>
              <option value="2">Th√°ng 2/2026</option>
              <option value="3">Th√°ng 3/2026</option>
              <option value="4">Th√°ng 4/2026</option>
              <option value="5">Th√°ng 5/2026</option>
              <option value="6">Th√°ng 6/2026</option>
              <option value="7">Th√°ng 7/2026</option>
              <option value="8">Th√°ng 8/2026</option>
              <option value="9">Th√°ng 9/2026</option>
              <option value="10">Th√°ng 10/2026</option>
              <option value="11">Th√°ng 11/2026</option>
              <option value="12">Th√°ng 12/2026</option>
            </select>
          </div>
        </header>

        <!-- Content -->
        <div class="flex-1 overflow-auto p-6">
          <!-- Summary Stats -->
          <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
            <div class="bg-white rounded-lg border border-gray-200 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">KPI Th√°ng</p>
                  <p
                    class="text-2xl font-bold text-gray-900 mt-1"
                    x-text="totalMonthlyTarget"
                  ></p>
                </div>
                <div
                  class="size-12 bg-blue-100 rounded-lg flex items-center justify-center"
                >
                  <span class="material-symbols-outlined text-blue-600"
                    >calendar_month</span
                  >
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg border border-gray-200 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">Ho√†n th√†nh</p>
                  <p
                    class="text-2xl font-bold text-green-600 mt-1"
                    x-text="totalCompleted"
                  ></p>
                </div>
                <div
                  class="size-12 bg-green-100 rounded-lg flex items-center justify-center"
                >
                  <span class="material-symbols-outlined text-green-600"
                    >check_circle</span
                  >
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg border border-gray-200 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">C√≤n l·∫°i</p>
                  <p
                    class="text-2xl font-bold text-orange-600 mt-1"
                    x-text="Math.max(remaining, 0)"
                  ></p>
                </div>
                <div
                  class="size-12 bg-orange-100 rounded-lg flex items-center justify-center"
                >
                  <span class="material-symbols-outlined text-orange-600"
                    >pending</span
                  >
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg border border-gray-200 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">Ti·∫øn ƒë·ªô</p>
                  <p
                    class="text-2xl font-bold mt-1"
                    :class="monthlyProgress >= 100 ? 'text-green-600' : 'text-gray-900'"
                    x-text="monthlyProgress + '%'"
                  ></p>
                </div>
                <div
                  class="size-12 rounded-lg flex items-center justify-center"
                  :class="monthlyProgress >= 100 ? 'bg-green-100' : 'bg-purple-100'"
                >
                  <span
                    class="material-symbols-outlined"
                    :class="monthlyProgress >= 100 ? 'text-green-600' : 'text-purple-600'"
                    >percent</span
                  >
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg border border-gray-200 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">So v·ªõi KPI NƒÉm</p>
                  <p
                    class="text-sm font-semibold text-gray-900 mt-1"
                    x-text="totalCompleted + '/' + totalAnnualTarget"
                  ></p>
                  <p
                    class="text-xs text-gray-500"
                    x-text="Math.round((totalCompleted/totalAnnualTarget)*100) + '%'"
                  ></p>
                </div>
                <div
                  class="size-12 bg-indigo-100 rounded-lg flex items-center justify-center"
                >
                  <span class="material-symbols-outlined text-indigo-600"
                    >trending_up</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Cards View -->
          <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6"
          >
            <template x-for="group in workGroups" :key="group.id">
              <div
                class="bg-white rounded-lg border border-gray-200 p-5 hover:shadow-lg transition-shadow"
              >
                <div class="flex items-start justify-between mb-4">
                  <div class="flex items-center gap-3">
                    <div
                      class="size-12 rounded-lg flex items-center justify-center"
                      :style="`background-color: ${group.color}20`"
                    >
                      <span
                        class="material-symbols-outlined text-2xl"
                        :style="`color: ${group.color}`"
                        x-text="group.icon"
                      ></span>
                    </div>
                    <div>
                      <h3
                        class="font-semibold text-gray-900"
                        x-text="group.name"
                      ></h3>
                      <p class="text-xs text-gray-500" x-text="group.code"></p>
                    </div>
                  </div>
                </div>

                <div class="space-y-3 mb-4">
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600">KPI Th√°ng</span>
                    <span
                      class="font-bold text-gray-900"
                      x-text="group.monthlyTarget"
                    ></span>
                  </div>
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600">Ho√†n th√†nh</span>
                    <span
                      class="font-bold text-green-600"
                      x-text="group.completed"
                    ></span>
                  </div>
                  <div class="flex items-center justify-between text-sm">
                    <span class="text-gray-600">KPI NƒÉm</span>
                    <span
                      class="text-gray-500"
                      x-text="group.completed + '/' + group.annualTarget"
                    ></span>
                  </div>
                </div>

                <div class="bg-gray-200 rounded-full h-3 overflow-hidden mb-2">
                  <div
                    class="h-full transition-all"
                    :class="group.monthlyProgress >= 100 ? 'bg-green-500' : 'bg-blue-500'"
                    :style="`width: ${Math.min(group.monthlyProgress, 100)}%`"
                  ></div>
                </div>

                <div class="flex items-center justify-between text-xs">
                  <span
                    :class="group.monthlyProgress >= 100 ? 'text-green-600 font-semibold' : 'text-gray-500'"
                    x-text="group.monthlyProgress >= 100 ? (group.monthlyProgress > 100 ? 'üéâ V∆∞·ª£t KPI th√°ng!' : '‚úì Ho√†n th√†nh KPI') : 'ƒêang th·ª±c hi·ªán'"
                  ></span>
                  <span
                    class="font-semibold"
                    :class="group.monthlyProgress >= 100 ? 'text-green-600' : 'text-gray-600'"
                    x-text="group.monthlyProgress + '%'"
                  ></span>
                </div>
              </div>
            </template>
          </div>

          <!-- Comparison Chart -->
          <div class="bg-white rounded-lg border border-gray-200 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
              So s√°nh ti·∫øn ƒë·ªô c√°c nh√≥m
            </h3>
            <canvas id="monthChart" height="80"></canvas>
          </div>
        </div>
      </main>
    </div>

    <script>
      function dashboardMonthlyPlan() {
        return {
          selectedMonth: "1",
          chart: null,
          workGroups: [
            {
              id: 1,
              code: "HUANLUYEN",
              name: "Hu·∫•n luy·ªán",
              annualTarget: 20,
              monthlyTarget: 2,
              completed: 2,
              icon: "military_tech",
              color: "#3B82F6",
            },
            {
              id: 2,
              code: "DIEUDONGG",
              name: "ƒêi·ªÅu ƒë·ªông",
              annualTarget: 30,
              monthlyTarget: 3,
              completed: 2,
              icon: "swap_horiz",
              color: "#10B981",
            },
            {
              id: 3,
              code: "CHINHTR",
              name: "Ch√≠nh tr·ªã",
              annualTarget: 30,
              monthlyTarget: 3,
              completed: 3,
              icon: "campaign",
              color: "#F59E0B",
            },
            {
              id: 4,
              code: "KTTC",
              name: "Ki·ªÉm tra TC",
              annualTarget: 15,
              monthlyTarget: 1,
              completed: 1,
              icon: "verified",
              color: "#EF4444",
            },
            {
              id: 5,
              code: "VANNGH·ªÄ",
              name: "VƒÉn ngh·ªá - TT",
              annualTarget: 12,
              monthlyTarget: 1,
              completed: 0,
              icon: "sports",
              color: "#8B5CF6",
            },
          ],

          init() {
            this.$nextTick(() => this.initChart());
          },

          get totalMonthlyTarget() {
            return this.workGroups.reduce((sum, g) => sum + g.monthlyTarget, 0);
          },

          get totalAnnualTarget() {
            return this.workGroups.reduce((sum, g) => sum + g.annualTarget, 0);
          },

          get totalCompleted() {
            return this.workGroups.reduce((sum, g) => sum + g.completed, 0);
          },

          get remaining() {
            return this.totalMonthlyTarget - this.totalCompleted;
          },

          get monthlyProgress() {
            return this.totalMonthlyTarget > 0
              ? Math.round(
                  (this.totalCompleted / this.totalMonthlyTarget) * 100
                )
              : 0;
          },

          loadMonthData() {
            console.log("Loading data for month:", this.selectedMonth);

            // Load realistic sample data for different months with varying targets and completion
            const monthData = {
              1: [
                // Th√°ng 1/2026
                { id: 1, monthlyTarget: 2, completed: 2 },
                { id: 2, monthlyTarget: 3, completed: 2 },
                { id: 3, monthlyTarget: 3, completed: 3 },
                { id: 4, monthlyTarget: 1, completed: 1 },
                { id: 5, monthlyTarget: 1, completed: 0 },
              ],
              2: [
                // Th√°ng 2/2026
                { id: 1, monthlyTarget: 2, completed: 2 },
                { id: 2, monthlyTarget: 2, completed: 1 },
                { id: 3, monthlyTarget: 3, completed: 2 },
                { id: 4, monthlyTarget: 2, completed: 2 },
                { id: 5, monthlyTarget: 1, completed: 1 },
              ],
              3: [
                // Th√°ng 3/2026
                { id: 1, monthlyTarget: 2, completed: 1 },
                { id: 2, monthlyTarget: 3, completed: 3 },
                { id: 3, monthlyTarget: 2, completed: 1 },
                { id: 4, monthlyTarget: 1, completed: 0 },
                { id: 5, monthlyTarget: 1, completed: 1 },
              ],
            };

            const data = monthData[this.selectedMonth];
            if (data) {
              this.workGroups = this.workGroups.map((g) => {
                const monthInfo = data.find((d) => d.id === g.id);
                return monthInfo ? { ...g, ...monthInfo } : g;
              });
            }

            this.$nextTick(() => this.initChart());
          },

          initChart() {
            const ctx = document.getElementById("monthChart");
            if (!ctx) return;
            if (this.chart) this.chart.destroy();

            this.chart = new Chart(ctx, {
              type: "bar",
              data: {
                labels: this.workGroups.map((g) => g.name),
                datasets: [
                  {
                    label: "KPI Th√°ng",
                    data: this.workGroups.map((g) => g.monthlyTarget),
                    backgroundColor: "#94A3B8",
                    borderRadius: 6,
                  },
                  {
                    label: "Ho√†n th√†nh",
                    data: this.workGroups.map((g) => g.completed),
                    backgroundColor: this.workGroups.map((g) =>
                      g.completed >= g.monthlyTarget ? "#10B981" : "#3B82F6"
                    ),
                    borderRadius: 6,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                  legend: { position: "top" },
                  title: {
                    display: true,
                    text: `Th√°ng ${this.selectedMonth}/2026`,
                    font: { size: 16, weight: "bold" },
                  },
                },
                scales: {
                  y: {
                    beginAtZero: true,
                    title: { display: true, text: "S·ªë l∆∞·ª£ng" },
                  },
                },
              },
            });
          },
        };
      }

      document.addEventListener("alpine:init", () => {
        Alpine.data("dashboardMonthlyPlan", () => {
          const base = dashboardMonthlyPlan();
          base.workGroups = base.workGroups.map((g) => ({
            ...g,
            get monthlyProgress() {
              return this.monthlyTarget > 0
                ? Math.round((this.completed / this.monthlyTarget) * 100)
                : 0;
            },
          }));
          return base;
        });
      });
    </script>
  </body>
</html>
