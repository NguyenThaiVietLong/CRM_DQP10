<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cài đặt Kế hoạch Tháng - Dân Quân Tự Vệ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }
    </style>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              olive: {
                DEFAULT: "#697565",
                50: "#f6f7f6",
                100: "#e3e6e2",
                200: "#c7cdc5",
                300: "#a5ada0",
                400: "#858e7f",
                500: "#697565",
                600: "#535d50",
                700: "#434a42",
                800: "#373c36",
                900: "#2f332e",
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-gray-50" x-data="settingsMonthlyPlan()">
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <aside
        class="w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col p-4 hidden md:flex h-full"
      >
        <div class="flex gap-3 px-2 py-2 mb-4">
          <div
            class="bg-olive/20 rounded-full size-10 flex items-center justify-center"
          >
            <span class="material-symbols-outlined text-olive">shield</span>
          </div>
          <div class="flex flex-col justify-center">
            <h1 class="text-gray-900 text-base font-bold">Dân Quân Tự Vệ</h1>
            <p class="text-gray-500 text-xs">Hệ thống quản lý</p>
          </div>
        </div>

        <nav class="flex flex-col gap-2">
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"
            href="index.html"
          >
            <span class="material-symbols-outlined text-gray-600">home</span>
            <p class="text-sm font-medium text-gray-600">Trang chủ</p>
          </a>
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"
            href="dashboard-annual-plan.html"
          >
            <span class="material-symbols-outlined text-gray-600"
              >calendar_today</span
            >
            <p class="text-sm font-medium text-gray-600">Dashboard KH Năm</p>
          </a>
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"
            href="dashboard-monthly-plan.html"
          >
            <span class="material-symbols-outlined text-gray-600"
              >calendar_month</span
            >
            <p class="text-sm font-medium text-gray-600">Dashboard KH Tháng</p>
          </a>
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-50 transition-colors"
            href="settings-annual-plan.html"
          >
            <span class="material-symbols-outlined text-gray-600"
              >settings</span
            >
            <p class="text-sm font-medium text-gray-600">Cài đặt KH Năm</p>
          </a>
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg bg-olive/10"
            href="#"
          >
            <span
              class="material-symbols-outlined text-olive"
              style="font-variation-settings: 'FILL' 1"
              >tune</span
            >
            <p class="text-sm font-bold text-olive">Cài đặt KH Tháng</p>
          </a>
        </nav>

        <div class="mt-auto pt-4 border-t border-gray-200 space-y-2">
          <a
            class="flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-bold bg-olive text-white hover:bg-olive/90 transition-colors justify-center"
            href="#"
          >
            <span class="material-symbols-outlined text-xl">logout</span>
            <span>Đăng xuất</span>
          </a>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header
          class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between"
        >
          <div>
            <h1 class="text-2xl font-bold text-gray-900">
              Cài đặt Kế hoạch Tháng
            </h1>
            <p class="text-sm text-gray-500 mt-1">
              Phân bổ KPI theo từng tháng trong năm
            </p>
          </div>
          <div class="flex items-center gap-3">
            <select
              x-model="selectedYear"
              class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive"
            >
              <option value="2026">Năm 2026</option>
              <option value="2025">Năm 2025</option>
            </select>
            <select
              x-model="selectedMonth"
              @change="loadMonthData"
              class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive"
            >
              <option value="1">Tháng 1</option>
              <option value="2">Tháng 2</option>
              <option value="3">Tháng 3</option>
              <option value="4">Tháng 4</option>
              <option value="5">Tháng 5</option>
              <option value="6">Tháng 6</option>
              <option value="7">Tháng 7</option>
              <option value="8">Tháng 8</option>
              <option value="9">Tháng 9</option>
              <option value="10">Tháng 10</option>
              <option value="11">Tháng 11</option>
              <option value="12">Tháng 12</option>
            </select>
          </div>
        </header>

        <!-- Content -->
        <div class="flex-1 overflow-auto p-6">
          <!-- Info Banner -->
          <div
            class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 flex items-start gap-3"
          >
            <span class="material-symbols-outlined text-blue-600 flex-shrink-0"
              >info</span
            >
            <div class="flex-1">
              <p class="text-sm font-medium text-blue-900">
                Lưu ý khi cài đặt KPI tháng
              </p>
              <p class="text-sm text-blue-700 mt-1">
                Tổng KPI của 12 tháng không nhất thiết phải bằng KPI năm. Bạn có
                thể phân bổ linh hoạt theo kế hoạch thực tế.
              </p>
            </div>
          </div>

          <!-- Summary Cards -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="bg-white rounded-lg border border-gray-200 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">KPI tháng này</p>
                  <p
                    class="text-2xl font-bold text-gray-900 mt-1"
                    x-text="monthlyKPI"
                  ></p>
                </div>
                <div
                  class="size-12 bg-blue-100 rounded-lg flex items-center justify-center"
                >
                  <span class="material-symbols-outlined text-blue-600"
                    >calendar_month</span
                  >
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg border border-gray-200 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">KPI cả năm</p>
                  <p
                    class="text-2xl font-bold text-gray-900 mt-1"
                    x-text="annualKPI"
                  ></p>
                </div>
                <div
                  class="size-12 bg-green-100 rounded-lg flex items-center justify-center"
                >
                  <span class="material-symbols-outlined text-green-600"
                    >calendar_today</span
                  >
                </div>
              </div>
            </div>
            <div class="bg-white rounded-lg border border-gray-200 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-gray-500">Tỷ lệ phân bổ</p>
                  <p
                    class="text-2xl font-bold text-gray-900 mt-1"
                    x-text="Math.round((monthlyKPI / annualKPI) * 100) + '%'"
                  ></p>
                </div>
                <div
                  class="size-12 bg-purple-100 rounded-lg flex items-center justify-center"
                >
                  <span class="material-symbols-outlined text-purple-600"
                    >percent</span
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Table -->
          <div
            class="bg-white rounded-lg border border-gray-200 overflow-hidden"
          >
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"
                    >
                      Nhóm công việc
                    </th>
                    <th
                      class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase"
                    >
                      KPI Năm
                    </th>
                    <th
                      class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase"
                    >
                      KPI Tháng
                    </th>
                    <th
                      class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase"
                    >
                      Đã hoàn thành
                    </th>
                    <th
                      class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase"
                    >
                      Tiến độ
                    </th>
                    <th
                      class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase"
                    >
                      Thao tác
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <template x-for="group in workGroups" :key="group.id">
                    <tr class="hover:bg-gray-50">
                      <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                          <div
                            class="size-10 rounded-lg flex items-center justify-center"
                            :style="`background-color: ${group.color}20`"
                          >
                            <span
                              class="material-symbols-outlined"
                              :style="`color: ${group.color}`"
                              x-text="group.icon"
                            ></span>
                          </div>
                          <div>
                            <p
                              class="font-medium text-gray-900"
                              x-text="group.name"
                            ></p>
                            <p
                              class="text-xs text-gray-500"
                              x-text="group.code"
                            ></p>
                          </div>
                        </div>
                      </td>
                      <td class="px-6 py-4 text-center">
                        <span
                          class="text-sm font-semibold text-gray-600"
                          x-text="group.annualTarget"
                        ></span>
                      </td>
                      <td class="px-6 py-4 text-center">
                        <input
                          type="number"
                          min="0"
                          x-model="group.monthlyTarget"
                          class="w-20 px-3 py-2 border border-gray-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-olive"
                        />
                      </td>
                      <td class="px-6 py-4 text-center">
                        <span
                          class="text-sm font-semibold text-green-600"
                          x-text="group.completed"
                        ></span>
                      </td>
                      <td class="px-6 py-4">
                        <div class="flex items-center gap-2 justify-center">
                          <div class="w-24 bg-gray-200 rounded-full h-2">
                            <div
                              class="h-2 rounded-full"
                              :class="group.monthlyProgress >= 100 ? 'bg-green-500' : 'bg-blue-500'"
                              :style="`width: ${Math.min(group.monthlyProgress, 100)}%`"
                            ></div>
                          </div>
                          <span
                            class="text-xs font-medium"
                            x-text="group.monthlyProgress + '%'"
                          ></span>
                        </div>
                      </td>
                      <td class="px-6 py-4 text-center">
                        <button
                          @click="copyFromPrevMonth(group)"
                          class="px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                          title="Copy từ tháng trước"
                        >
                          <span class="material-symbols-outlined text-sm"
                            >content_copy</span
                          >
                        </button>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Actions -->
          <div class="flex items-center justify-between mt-6">
            <button
              @click="autoAllocate"
              class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-2"
            >
              <span class="material-symbols-outlined">auto_awesome</span>
              <span>Phân bổ tự động</span>
            </button>
            <div class="flex items-center gap-3">
              <button
                class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Hủy
              </button>
              <button
                @click="saveMonthlyPlan"
                class="px-6 py-2 bg-olive text-white rounded-lg hover:bg-olive/90 transition-colors flex items-center gap-2"
              >
                <span class="material-symbols-outlined">save</span>
                <span>Lưu thay đổi</span>
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      function settingsMonthlyPlan() {
        return {
          selectedYear: "2026",
          selectedMonth: "1",
          workGroups: [
            {
              id: 1,
              code: "HUANLUYEN",
              name: "Công tác Huấn luyện",
              annualTarget: 20,
              monthlyTarget: 2,
              completed: 1,
              icon: "military_tech",
              color: "#3B82F6",
            },
            {
              id: 2,
              code: "DIEUDONGG",
              name: "Công tác Điều động",
              annualTarget: 30,
              monthlyTarget: 3,
              completed: 2,
              icon: "swap_horiz",
              color: "#10B981",
            },
            {
              id: 3,
              code: "CHINHTR",
              name: "Công tác Chính trị",
              annualTarget: 30,
              monthlyTarget: 3,
              completed: 3,
              icon: "campaign",
              color: "#F59E0B",
            },
            {
              id: 4,
              code: "KTTC",
              name: "Kiểm tra tính chiến đấu",
              annualTarget: 15,
              monthlyTarget: 1,
              completed: 1,
              icon: "verified",
              color: "#EF4444",
            },
            {
              id: 5,
              code: "VANNGHỀ",
              name: "Văn nghệ - Thể thao",
              annualTarget: 12,
              monthlyTarget: 1,
              completed: 0,
              icon: "sports",
              color: "#8B5CF6",
            },
          ],

          get monthlyKPI() {
            return this.workGroups.reduce(
              (sum, g) => sum + parseInt(g.monthlyTarget || 0),
              0
            );
          },

          get annualKPI() {
            return this.workGroups.reduce((sum, g) => sum + g.annualTarget, 0);
          },

          loadMonthData() {
            // Load realistic sample data for different months
            console.log("Loading data for month:", this.selectedMonth);

            const monthData = {
              1: [
                // Tháng 1/2026
                { id: 1, monthlyTarget: 2, completed: 1 },
                { id: 2, monthlyTarget: 3, completed: 2 },
                { id: 3, monthlyTarget: 3, completed: 3 },
                { id: 4, monthlyTarget: 1, completed: 1 },
                { id: 5, monthlyTarget: 1, completed: 0 },
              ],
              2: [
                // Tháng 2/2026
                { id: 1, monthlyTarget: 2, completed: 2 },
                { id: 2, monthlyTarget: 2, completed: 1 },
                { id: 3, monthlyTarget: 3, completed: 2 },
                { id: 4, monthlyTarget: 2, completed: 2 },
                { id: 5, monthlyTarget: 1, completed: 1 },
              ],
              3: [
                // Tháng 3/2026
                { id: 1, monthlyTarget: 2, completed: 1 },
                { id: 2, monthlyTarget: 3, completed: 3 },
                { id: 3, monthlyTarget: 2, completed: 1 },
                { id: 4, monthlyTarget: 1, completed: 0 },
                { id: 5, monthlyTarget: 1, completed: 1 },
              ],
            };

            const data = monthData[this.selectedMonth];
            if (data) {
              this.workGroups = this.workGroups.map((g) => {
                const monthInfo = data.find((d) => d.id === g.id);
                return monthInfo ? { ...g, ...monthInfo } : g;
              });
            }
          },

          autoAllocate() {
            // Auto-allocate evenly across 12 months
            if (confirm("Phân bổ đều KPI năm cho 12 tháng?")) {
              this.workGroups = this.workGroups.map((g) => ({
                ...g,
                monthlyTarget: Math.ceil(g.annualTarget / 12),
              }));
            }
          },

          copyFromPrevMonth(group) {
            alert(
              `Sao chép KPI tháng ${
                parseInt(this.selectedMonth) - 1
              } cho nhóm ${group.name}`
            );
          },

          saveMonthlyPlan() {
            alert(
              "Đã lưu kế hoạch tháng " + this.selectedMonth + " thành công!"
            );
          },
        };
      }

      // Add computed property for monthlyProgress
      document.addEventListener("alpine:init", () => {
        Alpine.data("settingsMonthlyPlan", () => {
          const base = settingsMonthlyPlan();
          base.workGroups = base.workGroups.map((g) => ({
            ...g,
            get monthlyProgress() {
              return this.monthlyTarget > 0
                ? Math.round((this.completed / this.monthlyTarget) * 100)
                : 0;
            },
          }));
          return base;
        });
      });
    </script>
  </body>
</html>
